{"version":3,"sources":["SpeechDaemon.js","AppStyles.js","components/MicrophoneSwitchStyles.js","components/MicrophoneSwitch.js","App.js","serviceWorker.js","index.js"],"names":["SpeechDaemon","options","recognition","window","webkitSpeechRecognition","SpeechRecognition","interimResults","continuous","onresult","event","emit","onsoundstart","console","log","Date","onsoundend","onnomatch","onerror","onstart","timeStamp","onend","_","hasAlreadyStarted","isIdle","listen","this","lang_","v","lang","start","stop","EventEmitter","styles","MicrophoneSwitch","props","isPowerOn","onClick","background","id","apply","icon","size","library","add","faMicrophone","faPlayCircle","faStopCircle","langs","App","n","speechLog","useRef","speech","useState","selectedIndex","setSelectedIndex","dialect","setDialect","finalTranscript","setFinalTranscript","interimTranscript","setInterimTranscript","setIsPowerOn","useEffect","current","on","transcript","buf","i","resultIndex","results","length","isFinal","error","kill","split","filter","x","slice","map","key","style","color","value","onChange","e","target","restart","visibility","type","a","document","createElement","href","encodeURIComponent","download","moment","format","click","Boolean","location","hostname","match","ReactDOM","render","StrictMode","getElementById","navigator","serviceWorker","ready","then","registration","unregister","catch","message"],"mappings":"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","file":"static/js/main.691b9101.chunk.js","sourcesContent":["import {EventEmitter} from 'events';\r\n\r\nexport default class SpeechDaemon extends EventEmitter {\r\n  get lang() { return this.lang_ }\r\n  set lang(v) { this.lang_ = v }\r\n\r\n  constructor(options) {\r\n    super()\r\n    const SpeechRecognition = window.webkitSpeechRecognition || window.SpeechRecognition;\r\n    const recognition = new SpeechRecognition();\r\n    recognition.interimResults = true;\r\n    recognition.continuous = true;\r\n\r\n    recognition.onresult = (event)=>{\r\n      this.emit(\"result\", event);\r\n    };\r\n    recognition.onsoundstart = (event) => {\r\n      console.log(`${new Date()}認識中...`)\r\n      this.emit(\"soundstart\", null);\r\n    };\r\n    recognition.onsoundend = () => { this.emit(\"soundend\", null) };\r\n    recognition.onnomatch = () => {\r\n      console.log(`${new Date()} 音声を認識できませんでした`)\r\n      this.emit('nomatch', null)\r\n    };\r\n    recognition.onerror = (event) => {\r\n      console.log(event)\r\n      this.emit('error', event)\r\n    };\r\n    recognition.onstart = (event) => {\r\n      console.log(`${new Date()} ${(event.timeStamp)} 音声認識サービス開始 ->>>>>`)\r\n      this.emit('start', null)\r\n    };\r\n    recognition.onend = _ => {\r\n      console.log(`${new Date()} <<<<<- 音声認識サービス切断`)\r\n      this.hasAlreadyStarted = false\r\n      this.emit('end', null)\r\n      if(this.isIdle) return;\r\n      this.listen()\r\n    };\r\n    this.recognition = recognition\r\n    this.isIdle = false\r\n    this.hasAlreadyStarted = false\r\n  }\r\n\r\n  listen() {\r\n    if(this.hasAlreadyStarted) {\r\n      return\r\n    }\r\n    this.hasAlreadyStarted = true\r\n    this.isIdle = false\r\n    if(this.lang) {\r\n      this.recognition.lang = this.lang\r\n    }\r\n    this.recognition.start();\r\n  }\r\n\r\n  kill() {\r\n    this.isIdle = true\r\n    this.recognition.stop();\r\n  }\r\n\r\n  restart() {\r\n    this.isIdle = false\r\n    this.recognition.stop();\r\n  }\r\n}","import css from 'styled-jsx/css'\r\nconst styles = css`\r\n.app {\r\n  text-align: center;\r\n}\r\n\r\n#results {\r\n  font-size: 14px;\r\n  font-weight: bold;\r\n  border: 1px solid #ddd;\r\n  padding: 15px;\r\n  text-align: left;\r\n  min-height: 100px;\r\n}\r\n\r\n.tools {\r\n  display: flex;\r\n  justify-content: space-between;\r\n}\r\n`\r\n\r\nexport default styles","import css from 'styled-jsx/css'\r\n\r\nconst styles = css`\r\n.microphone-switch {\r\n  position: relative;\r\n}\r\n\r\n@keyframes shiny {\r\n  0% {\r\n    transform: scale(0) rotate(25deg);\r\n    opacity: 0;\r\n  }\r\n  50% {\r\n    transform: scale(1) rotate(25deg);\r\n    opacity: 1;\r\n  }\r\n  100% {\r\n    transform: scale(50) rotate(25deg);\r\n    opacity: 0;\r\n  }\r\n}\r\n\r\n.shiny-btn {\r\n  position: relative;\r\n  overflow: hidden;\r\n}\r\n\r\n.shiny-btn::after {\r\n  content: '';\r\n  position: absolute;\r\n  top: -100px;\r\n  left: -100px;\r\n  width: 50px;\r\n  height: 50px;\r\n  background-image: linear-gradient(100deg, rgba(255, 255, 255, 0) 10%, rgba(255, 255, 255, 1) 100%, rgba(255, 255, 255, 0) 0%);\r\n  animation-name: shiny;\r\n  animation-duration: 2s;\r\n  animation-timing-function: ease-in-out;\r\n  animation-iteration-count: infinite;\r\n}\r\n\r\n.circle {\r\n  border-radius: 50%;\r\n  display: flex;\r\n  align-items: center;\r\n  justify-content: center;\r\n  text-align: center;\r\n}\r\n\r\n.microphone-on,\r\n.microphone-off {\r\n  cursor: pointer;\r\n}\r\n\r\n.microphone-on {\r\n  background: #1373C7;\r\n  width: 80px;\r\n  height: 80px;\r\n  color: #FFF;\r\n}\r\n\r\n.microphone-off {\r\n  background: #FFF;\r\n  width: 70px;\r\n  height: 70px;\r\n  border: solid 5px #ED1C22;\r\n  color: #1373C7;\r\n}\r\n\r\n.heartbeat {\r\n  position: absolute;\r\n  top: 0;\r\n  left: 0;\r\n  animation: pounding .1s linear infinite alternate;\r\n  opacity: 0.2;\r\n  z-index: -99;\r\n  background: #1373C7;\r\n  width: 80px;\r\n  height: 80px;\r\n}\r\n\r\n@keyframes pounding {\r\n  0% {\r\n    transform: scale(1.3);\r\n  }\r\n  100% {\r\n    transform: scale(1);\r\n  }\r\n}\r\n`\r\n\r\nexport default styles","import React from 'react';\r\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome'\r\nimport styles from './MicrophoneSwitchStyles';\r\n\r\nfunction MicrophoneSwitch(props) {\r\n  const { isPowerOn, onClick } = props\r\n  const background = props.background || '#1373C7'\r\n  const handleClick = _ => {\r\n    onClick && onClick.apply()\r\n  }\r\n\r\n  return (\r\n  <div className=\"microphone-switch\">\r\n    <div id=\"microphone\"\r\n         onClick={handleClick}\r\n         className={`circle microphone-${isPowerOn ? 'on shiny-btn' : 'off'}`}>\r\n      <div><FontAwesomeIcon icon=\"microphone\" size=\"2x\" /></div>\r\n    </div>\r\n    <div id=\"heartbeat\" className={`circle ${isPowerOn ? 'heartbeat' : ''}`}></div>\r\n\r\n    <style jsx>{styles}</style>\r\n  </div>)\r\n}\r\n\r\nexport default MicrophoneSwitch;","import React, { useState, useEffect, useRef } from 'react';\r\nimport './App.css';\r\nimport SpeechDaemon from './SpeechDaemon';\r\nimport styles from './AppStyles';\r\nimport MicrophoneSwitch from './components/MicrophoneSwitch';\r\nimport { library } from '@fortawesome/fontawesome-svg-core'\r\nimport { faMicrophone, faPlayCircle, faStopCircle } from '@fortawesome/free-solid-svg-icons'\r\nimport moment from 'moment';\r\n\r\nlibrary.add(faMicrophone, faPlayCircle, faStopCircle)\r\n\r\nvar langs =\r\n[['Afrikaans',       ['af-ZA']],\r\n ['አማርኛ',           ['am-ET']],\r\n ['Azərbaycanca',    ['az-AZ']],\r\n ['বাংলা',            ['bn-BD', 'বাংলাদেশ'],\r\n                     ['bn-IN', 'ভারত']],\r\n ['Bahasa Indonesia',['id-ID']],\r\n ['Bahasa Melayu',   ['ms-MY']],\r\n ['Català',          ['ca-ES']],\r\n ['Čeština',         ['cs-CZ']],\r\n ['Dansk',           ['da-DK']],\r\n ['Deutsch',         ['de-DE']],\r\n ['English',         ['en-AU', 'Australia'],\r\n                     ['en-CA', 'Canada'],\r\n                     ['en-IN', 'India'],\r\n                     ['en-KE', 'Kenya'],\r\n                     ['en-TZ', 'Tanzania'],\r\n                     ['en-GH', 'Ghana'],\r\n                     ['en-NZ', 'New Zealand'],\r\n                     ['en-NG', 'Nigeria'],\r\n                     ['en-ZA', 'South Africa'],\r\n                     ['en-PH', 'Philippines'],\r\n                     ['en-GB', 'United Kingdom'],\r\n                     ['en-US', 'United States']],\r\n ['Español',         ['es-AR', 'Argentina'],\r\n                     ['es-BO', 'Bolivia'],\r\n                     ['es-CL', 'Chile'],\r\n                     ['es-CO', 'Colombia'],\r\n                     ['es-CR', 'Costa Rica'],\r\n                     ['es-EC', 'Ecuador'],\r\n                     ['es-SV', 'El Salvador'],\r\n                     ['es-ES', 'España'],\r\n                     ['es-US', 'Estados Unidos'],\r\n                     ['es-GT', 'Guatemala'],\r\n                     ['es-HN', 'Honduras'],\r\n                     ['es-MX', 'México'],\r\n                     ['es-NI', 'Nicaragua'],\r\n                     ['es-PA', 'Panamá'],\r\n                     ['es-PY', 'Paraguay'],\r\n                     ['es-PE', 'Perú'],\r\n                     ['es-PR', 'Puerto Rico'],\r\n                     ['es-DO', 'República Dominicana'],\r\n                     ['es-UY', 'Uruguay'],\r\n                     ['es-VE', 'Venezuela']],\r\n ['Euskara',         ['eu-ES']],\r\n ['Filipino',        ['fil-PH']],\r\n ['Français',        ['fr-FR']],\r\n ['Basa Jawa',       ['jv-ID']],\r\n ['Galego',          ['gl-ES']],\r\n ['ગુજરાતી',           ['gu-IN']],\r\n ['Hrvatski',        ['hr-HR']],\r\n ['IsiZulu',         ['zu-ZA']],\r\n ['Íslenska',        ['is-IS']],\r\n ['Italiano',        ['it-IT', 'Italia'],\r\n                     ['it-CH', 'Svizzera']],\r\n ['ಕನ್ನಡ',             ['kn-IN']],\r\n ['ភាសាខ្មែរ',          ['km-KH']],\r\n ['Latviešu',        ['lv-LV']],\r\n ['Lietuvių',        ['lt-LT']],\r\n ['മലയാളം',          ['ml-IN']],\r\n ['मराठी',             ['mr-IN']],\r\n ['Magyar',          ['hu-HU']],\r\n ['ລາວ',              ['lo-LA']],\r\n ['Nederlands',      ['nl-NL']],\r\n ['नेपाली भाषा',        ['ne-NP']],\r\n ['Norsk bokmål',    ['nb-NO']],\r\n ['Polski',          ['pl-PL']],\r\n ['Português',       ['pt-BR', 'Brasil'],\r\n                     ['pt-PT', 'Portugal']],\r\n ['Română',          ['ro-RO']],\r\n ['සිංහල',          ['si-LK']],\r\n ['Slovenščina',     ['sl-SI']],\r\n ['Basa Sunda',      ['su-ID']],\r\n ['Slovenčina',      ['sk-SK']],\r\n ['Suomi',           ['fi-FI']],\r\n ['Svenska',         ['sv-SE']],\r\n ['Kiswahili',       ['sw-TZ', 'Tanzania'],\r\n                     ['sw-KE', 'Kenya']],\r\n ['ქართული',       ['ka-GE']],\r\n ['Հայերեն',          ['hy-AM']],\r\n ['தமிழ்',            ['ta-IN', 'இந்தியா'],\r\n                     ['ta-SG', 'சிங்கப்பூர்'],\r\n                     ['ta-LK', 'இலங்கை'],\r\n                     ['ta-MY', 'மலேசியா']],\r\n ['తెలుగు',           ['te-IN']],\r\n ['Tiếng Việt',      ['vi-VN']],\r\n ['Türkçe',          ['tr-TR']],\r\n ['اُردُو',            ['ur-PK', 'پاکستان'],\r\n                     ['ur-IN', 'بھارت']],\r\n ['Ελληνικά',         ['el-GR']],\r\n ['български',         ['bg-BG']],\r\n ['Pусский',          ['ru-RU']],\r\n ['Српски',           ['sr-RS']],\r\n ['Українська',        ['uk-UA']],\r\n ['한국어',            ['ko-KR']],\r\n ['中文',             ['cmn-Hans-CN', '普通话 (中国大陆)'],\r\n                     ['cmn-Hans-HK', '普通话 (香港)'],\r\n                     ['cmn-Hant-TW', '中文 (台灣)'],\r\n                     ['yue-Hant-HK', '粵語 (香港)']],\r\n ['日本語',           ['ja-JP']],\r\n ['हिन्दी',             ['hi-IN']],\r\n ['ภาษาไทย',         ['th-TH']]];\r\n\r\nfunction App() {\r\n  const speechLog = useRef('');\r\n  const speech = useRef(new SpeechDaemon());\r\n  const [selectedIndex, setSelectedIndex] = useState(57);\r\n  const [dialect, setDialect] = useState(langs[selectedIndex][1][0]);\r\n  const [finalTranscript, setFinalTranscript] = useState('');\r\n  const [interimTranscript, setInterimTranscript] = useState('');\r\n  const [isPowerOn, setIsPowerOn] = useState(false);\r\n\r\n  const updateCountry = e => {\r\n    speech.current.lang = langs[e.target.value][1][0]\r\n    speech.current.restart()\r\n\r\n    setSelectedIndex(e.target.value)\r\n    setDialect(speech.current.lang)\r\n  }\r\n\r\n  const initialize = _ => {\r\n    console.log('初期化処理')\r\n    speech.current.on('result', (event) => {\r\n      let transcript = ''\r\n      let buf = ''\r\n      for (let i = event.resultIndex; i < event.results.length; i++) {\r\n        transcript = event.results[i][0].transcript;\r\n        if (event.results[i].isFinal) {\r\n          if (speech.current.lang === 'ja-JP') {\r\n            transcript += '。';\r\n          }\r\n          speechLog.current += transcript + '\\n'\r\n          console.log(speechLog.current)\r\n          setFinalTranscript(speechLog.current)\r\n        } else {\r\n          buf += transcript\r\n        }\r\n        setInterimTranscript(buf)\r\n      }\r\n    })\r\n    .on('start', () => {\r\n      console.log(\"話しかけてみて\")\r\n    }).on('soundstart', () => {\r\n      console.log(\"認識中...\")\r\n    }).on('soundend', () => {\r\n      console.log(\"停止中\")\r\n    }).on('nomatch', (event) => {\r\n      console.log('音声を認識できませんでした')\r\n    }).on('error', (event) => {\r\n      console.log('エラー: ' + event.error)\r\n    })\r\n  }\r\n\r\n  useEffect(initialize, [])\r\n\r\n  if(isPowerOn) {\r\n    console.log('Microphone On')\r\n    speech.current.lang = dialect\r\n    speech.current.listen()\r\n  } else {\r\n    console.log('onMicrophone Off')\r\n    speech.current.kill()\r\n  }\r\n\r\n  const latelyTranscript = (n) => {\r\n    return finalTranscript.split('\\n')\r\n      .filter(x => x.length > 0)\r\n      .slice(-1 * n)\r\n      .map((x, i) => <p key={i}>{x}</p>)\r\n  }\r\n\r\n  const downloadLogFile = () => {\r\n    const a = document.createElement('a');\r\n    a.href = 'data:text/plain,' + encodeURIComponent(finalTranscript);\r\n    a.download = `log${moment().format('_YYYYMMDD_HHmmss')}.txt`;\r\n    a.click();\r\n  }\r\n\r\n  return (\r\n    <div className=\"app\">\r\n      <div id=\"results\">\r\n        <span className=\"final\" id=\"final_span\">{latelyTranscript(10)}</span>\r\n        <span className=\"interim\" id=\"interim_span\" style={{color: \"gray\"}}>{interimTranscript}</span>\r\n      </div>\r\n\r\n      <div className=\"tools\">\r\n        <div className=\"compact marquee\" id=\"div_language\">\r\n          <select id=\"select_language\" value={selectedIndex} onChange={updateCountry}>\r\n          {\r\n            langs.map((x, i) => <option key={x[0]} value={i}>{x[0]}</option>)\r\n          }\r\n          </select>&nbsp;&nbsp; \r\n          <select id=\"select_dialect\" style={{visibility: langs[selectedIndex][1].length === 1 ? 'hidden' : 'visible'}}>\r\n          {\r\n            langs[selectedIndex]\r\n              .filter((x, i) => i > 0)\r\n              .map((x ,i) => <option key={i} value={x[0]}>{x[1]||''}</option>)\r\n          }\r\n          </select>\r\n        </div>\r\n\r\n        <MicrophoneSwitch isPowerOn={isPowerOn}\r\n                          onClick={() => {setIsPowerOn(!isPowerOn)}} />\r\n\r\n        <div><input type=\"button\" value=\"ログをダウンロード\" onClick={downloadLogFile} /></div>\r\n      </div>\r\n      <style jsx>{styles}</style>\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default App;\r\n","// This optional code is used to register a service worker.\n// register() is not called by default.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on subsequent visits to a page, after all the\n// existing tabs open on the page have been closed, since previously cached\n// resources are updated in the background.\n\n// To learn more about the benefits of this model and instructions on how to\n// opt-in, read https://bit.ly/CRA-PWA\n\nconst isLocalhost = Boolean(\n  window.location.hostname === 'localhost' ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === '[::1]' ||\n    // 127.0.0.0/8 are considered localhost for IPv4.\n    window.location.hostname.match(\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\n    )\n);\n\nexport function register(config) {\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(process.env.PUBLIC_URL, window.location.href);\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\n      return;\n    }\n\n    window.addEventListener('load', () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n      if (isLocalhost) {\n        // This is running on localhost. Let's check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl, config);\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            'This web app is being served cache-first by a service ' +\n              'worker. To learn more, visit https://bit.ly/CRA-PWA'\n          );\n        });\n      } else {\n        // Is not localhost. Just register service worker\n        registerValidSW(swUrl, config);\n      }\n    });\n  }\n}\n\nfunction registerValidSW(swUrl, config) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then(registration => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing;\n        if (installingWorker == null) {\n          return;\n        }\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === 'installed') {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the updated precached content has been fetched,\n              // but the previous service worker will still serve the older\n              // content until all client tabs are closed.\n              console.log(\n                'New content is available and will be used when all ' +\n                  'tabs for this page are closed. See https://bit.ly/CRA-PWA.'\n              );\n\n              // Execute callback\n              if (config && config.onUpdate) {\n                config.onUpdate(registration);\n              }\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log('Content is cached for offline use.');\n\n              // Execute callback\n              if (config && config.onSuccess) {\n                config.onSuccess(registration);\n              }\n            }\n          }\n        };\n      };\n    })\n    .catch(error => {\n      console.error('Error during service worker registration:', error);\n    });\n}\n\nfunction checkValidServiceWorker(swUrl, config) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl, {\n    headers: { 'Service-Worker': 'script' },\n  })\n    .then(response => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      const contentType = response.headers.get('content-type');\n      if (\n        response.status === 404 ||\n        (contentType != null && contentType.indexOf('javascript') === -1)\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then(registration => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl, config);\n      }\n    })\n    .catch(() => {\n      console.log(\n        'No internet connection found. App is running in offline mode.'\n      );\n    });\n}\n\nexport function unregister() {\n  if ('serviceWorker' in navigator) {\n    navigator.serviceWorker.ready\n      .then(registration => {\n        registration.unregister();\n      })\n      .catch(error => {\n        console.error(error.message);\n      });\n  }\n}\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './App';\nimport * as serviceWorker from './serviceWorker';\n\nReactDOM.render(\n  <React.StrictMode>\n    <App />\n  </React.StrictMode>,\n  document.getElementById('root')\n);\n\n// If you want your app to work offline and load faster, you can change\n// unregister() to register() below. Note this comes with some pitfalls.\n// Learn more about service workers: https://bit.ly/CRA-PWA\nserviceWorker.unregister();\n"],"sourceRoot":""}